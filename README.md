# Telegram Bot with GitLab Integration

Этот проект представляет собой Telegram-бота,
который интегрирован с GitLab для отправки уведомлений о событиях,
таких как создание ишью и мердж-реквестов.

Бот поддерживает отправку сообщений как в чаты, так и в треды, если указан `thread_id`.

## Возможности бота
1. Echo-функция:

- Бот отвечает на команду "чек" сообщением с информацией о `chat_id` и `thread_id` (если есть).

2. Интеграция с GitLab:

- Бот получает уведомления от GitLab через вебхуки.
- Отправляет уведомления о создании ишью и мердж-реквестов в указанные чаты или треды.
- Поддерживает перевод действий (например, "open" → "открыл") для удобства русскоязычных пользователей.

3. Отправка сообщений в треды:

- Если в настройках указан `thread_id`, бот отправляет сообщения в указанный тред.
- В противном случае сообщения отправляются в чат.

## Как запустить бота

### 1. Установка зависимостей

Для работы бота необходимы следующие библиотеки:

- `Flask`
- `pyTelegramBotAPI`

Установите их с помощью pip:

```bash
pip install Flask
pip install pyTelegramBotAPI
```

### 2. Настройка бота

1. Создайте файл `settings.txt` в корневой директории проекта и заполните его следующим образом:

    ```
    http://your-domain.com/
    YOUR_TELEGRAM_BOT_TOKEN
    CHAT_ID1,CHAT_ID2:THREAD_ID2
    YOUR_TELEGRAM_WEBHOOK_SECRET
    YOUR_GITLAB_WEBHOOK_SECRET
    ```

    - `http://your-domain.com/` — URL вашего сервера.
    - `YOUR_TELEGRAM_BOT_TOKEN` — токен вашего Telegram-бота.
    - `CHAT_ID1,CHAT_ID2:THREAD_ID2` — ID чатов и тредов, куда будут отправляться уведомления. Если тред не используется, укажите только ID чата.
    - `YOUR_TELEGRAM_WEBHOOK_SECRET` — секретный ключ для вебхука Telegram.
    - `YOUR_GITLAB_WEBHOOK_SECRET` — секретный ключ для вебхука GitLab.

2. Убедитесь, что ваш сервер доступен по указанному домену и может принимать входящие запросы.

### 3. Запуск бота

Запустите бота с помощью команды:

```bash
python flask_app.py
```

### 4. Настройка вебхуков

1. **Telegram Webhook**:
    - Убедитесь, что вебхук Telegram настроен автоматически при запуске бота (это происходит в коде с помощью `bot.set_webhook`).

2. **GitLab Webhook**:
    - В настройках вашего проекта GitLab добавьте вебхук с URL `http://your-domain.com/YOUR_GITLAB_WEBHOOK_SECRET`.
    - Укажите события, которые вы хотите отслеживать (например, "Issue Hook" и "Merge Request Hook").

## Как работает бот

- Бот слушает входящие вебхуки от GitLab.
- При получении события бот формирует сообщение и отправляет его в указанные чаты и треды.
- Бот также поддерживает команду "чек", которая отправляет информацию о `chat_id` и `thread_id`, если они есть.

## Пример сообщения

Когда пользователь открывает ишью или мердж-реквест, бот отправляет сообщение в формате:

```
*Имя пользователя* открыл ишью #123 "Название ишью"

https://gitlab.com/your-project/issues/123
```
